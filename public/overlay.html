<!doctype html>
<html><head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ButtCaster Overlay</title>
<link rel="stylesheet" href="/css/overlay.css"/>
<script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <div id="root">
    <div class="glow pink" id="glowPink"></div>
    <div class="glow blue" id="glowBlue"></div>
    <img class="watermark" id="wm" src="/img/watermark.svg" width="160"/>
    <div class="goal" id="goal"><div class="fill" id="goalFill"></div><div class="rem">Remaining: <b id="rem">0</b></div></div>
  </div>
  <script>
    const s = io(); let overlay={ goalTarget:2000, goalProgress:0, glow:true, watermark:true };
    function apply(){
      document.getElementById('glowPink').style.display = overlay.glow?'block':'none';
      document.getElementById('glowBlue').style.display = overlay.glow?'block':'none';
      document.getElementById('wm').style.display = overlay.watermark?'block':'none';
      const pct = Math.max(0, Math.min(100, (overlay.goalProgress/overlay.goalTarget)*100));
      document.getElementById('goalFill').style.width = pct+'%';
      document.getElementById('rem').textContent = Math.max(0, overlay.goalTarget - overlay.goalProgress);
    }
    s.on('init', st=>{ overlay={...overlay, ...(st?.overlay||{})}; apply(); });
    s.on('overlay:update', ov=>{ overlay={...overlay, ...ov}; apply(); });
    s.on('overlay:goal', g=>{ overlay.goalTarget=g.target; overlay.goalProgress=g.current||g.progress||0; apply(); });
    function fit(){ const sw=innerWidth, sh=innerHeight; const sc=Math.min(sw/1920, sh/1080); document.getElementById('root').style.transform='scale('+sc+')'; }
    addEventListener('resize', fit); fit();
  </script>
</body></html>
